#ifndef _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_
#define _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_

#include <assert.h>
#include <stdint.h>

typedef enum {
  THUMB_OPCODE_ADCS = 0u,
  THUMB_OPCODE_ADD_ANY = 1u,
  THUMB_OPCODE_ADD_PC = 2u,
  THUMB_OPCODE_ADD_PC_I7 = 3u,
  THUMB_OPCODE_ADD_SP = 4u,
  THUMB_OPCODE_ADDS = 5u,
  THUMB_OPCODE_ADDS_I3 = 6u,
  THUMB_OPCODE_ADDS_I8 = 7u,
  THUMB_OPCODE_ANDS = 8u,
  THUMB_OPCODE_ASRS = 9u,
  THUMB_OPCODE_ASRS_I5 = 10u,
  THUMB_OPCODE_B = 11u,
  THUMB_OPCODE_B_COND = 12u,
  THUMB_OPCODE_BICS = 13u,
  THUMB_OPCODE_BL_HIGH = 14u,
  THUMB_OPCODE_BL_LOW = 15u,
  THUMB_OPCODE_BX = 16u,
  THUMB_OPCODE_CMN = 17u,
  THUMB_OPCODE_CMP = 18u,
  THUMB_OPCODE_CMP_I8 = 19u,
  THUMB_OPCODE_CMP_ANY = 20u,
  THUMB_OPCODE_EORS = 21u,
  THUMB_OPCODE_LDMIA = 22u,
  THUMB_OPCODE_LDR = 23u,
  THUMB_OPCODE_LDR_I5 = 24u,
  THUMB_OPCODE_LDR_PC_OFFSET_I8 = 25u,
  THUMB_OPCODE_LDR_SP_OFFSET_I8 = 26u,
  THUMB_OPCODE_LDRB = 27u,
  THUMB_OPCODE_LDRB_I5 = 28u,
  THUMB_OPCODE_LDRH = 29u,
  THUMB_OPCODE_LDRH_I5 = 30u,
  THUMB_OPCODE_LDRSB = 31u,
  THUMB_OPCODE_LDRSH = 32u,
  THUMB_OPCODE_LSLS = 33u,
  THUMB_OPCODE_LSLS_I5 = 34u,
  THUMB_OPCODE_LSRS = 35u,
  THUMB_OPCODE_LSRS_I5 = 36u,
  THUMB_OPCODE_MOV_ANY = 37u,
  THUMB_OPCODE_MOVS_I8 = 38u,
  THUMB_OPCODE_MULS = 39u,
  THUMB_OPCODE_MVNS = 40u,
  THUMB_OPCODE_NEGS = 41u,
  THUMB_OPCODE_ORRS = 42u,
  THUMB_OPCODE_POP = 43u,
  THUMB_OPCODE_PUSH = 44u,
  THUMB_OPCODE_RORS = 45u,
  THUMB_OPCODE_SBCS = 46u,
  THUMB_OPCODE_STMIA = 47u,
  THUMB_OPCODE_STR = 48u,
  THUMB_OPCODE_STR_I5 = 49u,
  THUMB_OPCODE_STR_SP_OFFSET_I8 = 50u,
  THUMB_OPCODE_STRB = 51u,
  THUMB_OPCODE_STRB_I5 = 52u,
  THUMB_OPCODE_STRH = 53u,
  THUMB_OPCODE_STRH_I5 = 54u,
  THUMB_OPCODE_SUB_SP_I7 = 55u,
  THUMB_OPCODE_SUBS = 56u,
  THUMB_OPCODE_SUBS_I3 = 57u,
  THUMB_OPCODE_SUBS_I8 = 58u,
  THUMB_OPCODE_SWI = 59u,
  THUMB_OPCODE_TST = 60u,
  THUMB_OPCODE_UNDEF = 61u,
} ThumbOpcode;

static inline ThumbOpcode ThumbDecodeOpcode(uint16_t instruction) {
  static const uint8_t opcode_table[1024] = {
      34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u,
      34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u, 34u,
      34u, 34u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u,
      36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u, 36u,
      36u, 36u, 36u, 36u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u,
      10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u,
      10u, 10u, 10u, 10u, 10u, 10u, 5u,  5u,  5u,  5u,  5u,  5u,  5u,  5u,  56u,
      56u, 56u, 56u, 56u, 56u, 56u, 56u, 6u,  6u,  6u,  6u,  6u,  6u,  6u,  6u,
      57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 38u, 38u, 38u, 38u, 38u, 38u, 38u,
      38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u,
      38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 38u, 19u, 19u, 19u, 19u, 19u,
      19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u,
      19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 19u, 7u,  7u,  7u,
      7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,
      7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  58u,
      58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u,
      58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u, 58u,
      58u, 8u,  21u, 33u, 35u, 9u,  0u,  46u, 45u, 60u, 41u, 18u, 17u, 42u, 39u,
      13u, 40u, 1u,  1u,  1u,  1u,  20u, 20u, 20u, 20u, 37u, 37u, 37u, 37u, 16u,
      16u, 61u, 61u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u,
      25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u,
      25u, 25u, 25u, 25u, 25u, 48u, 48u, 48u, 48u, 48u, 48u, 48u, 48u, 53u, 53u,
      53u, 53u, 53u, 53u, 53u, 53u, 51u, 51u, 51u, 51u, 51u, 51u, 51u, 51u, 31u,
      31u, 31u, 31u, 31u, 31u, 31u, 31u, 23u, 23u, 23u, 23u, 23u, 23u, 23u, 23u,
      29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 27u, 27u, 27u, 27u, 27u, 27u, 27u,
      27u, 32u, 32u, 32u, 32u, 32u, 32u, 32u, 32u, 49u, 49u, 49u, 49u, 49u, 49u,
      49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u,
      49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 49u, 24u, 24u, 24u, 24u,
      24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u,
      24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 24u, 52u, 52u,
      52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u,
      52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u,
      28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u,
      28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u,
      28u, 28u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u,
      54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u,
      54u, 54u, 54u, 54u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u,
      30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u, 30u,
      30u, 30u, 30u, 30u, 30u, 30u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u,
      50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u,
      50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 26u, 26u, 26u, 26u, 26u, 26u, 26u,
      26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u,
      26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 2u,  2u,  2u,  2u,  2u,
      2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,
      2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  4u,  4u,  4u,
      4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,
      4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  4u,  3u,
      3u,  55u, 55u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      44u, 44u, 44u, 44u, 44u, 44u, 44u, 44u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 43u, 43u, 43u, 43u, 43u, 43u, 43u, 43u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 61u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u,
      47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u,
      47u, 47u, 47u, 47u, 47u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u,
      22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u,
      22u, 22u, 22u, 22u, 22u, 22u, 22u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u,
      12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u,
      12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u,
      12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u, 12u,
      12u, 12u, 12u, 61u, 61u, 61u, 61u, 59u, 59u, 59u, 59u, 11u, 11u, 11u, 11u,
      11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u,
      11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 14u, 14u,
      14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u,
      14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u, 14u,
      15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u,
      15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u, 15u,
      15u, 15u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 61u, 61u,
  };

  uint_fast8_t opcode_index = instruction >> 6u;
  assert(opcode_index <= 1024);

  return (ThumbOpcode)opcode_table[opcode_index];
}

#endif  // _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_