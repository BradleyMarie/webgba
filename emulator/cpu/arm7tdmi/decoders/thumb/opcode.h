#ifndef _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_
#define _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_

#include <assert.h>
#include <stdint.h>

typedef enum {
  THUMB_OPCODE_ADCS = 0u,
  THUMB_OPCODE_ADD_ANY = 1u,
  THUMB_OPCODE_ADD_PC = 2u,
  THUMB_OPCODE_ADD_SP = 3u,
  THUMB_OPCODE_ADD_SP_I7 = 4u,
  THUMB_OPCODE_ADDS = 5u,
  THUMB_OPCODE_ADDS_I3 = 6u,
  THUMB_OPCODE_ADDS_I8 = 7u,
  THUMB_OPCODE_ANDS = 8u,
  THUMB_OPCODE_ASRS = 9u,
  THUMB_OPCODE_ASRS_I5 = 10u,
  THUMB_OPCODE_B_FWD = 11u,
  THUMB_OPCODE_B_FWD_COND = 12u,
  THUMB_OPCODE_B_REV = 13u,
  THUMB_OPCODE_B_REV_COND = 14u,
  THUMB_OPCODE_BICS = 15u,
  THUMB_OPCODE_BL = 16u,
  THUMB_OPCODE_BL_FWD = 17u,
  THUMB_OPCODE_BL_REV = 18u,
  THUMB_OPCODE_BX = 19u,
  THUMB_OPCODE_CMN = 20u,
  THUMB_OPCODE_CMP = 21u,
  THUMB_OPCODE_CMP_I8 = 22u,
  THUMB_OPCODE_CMP_ANY = 23u,
  THUMB_OPCODE_EORS = 24u,
  THUMB_OPCODE_LDMIA = 25u,
  THUMB_OPCODE_LDR = 26u,
  THUMB_OPCODE_LDR_I5 = 27u,
  THUMB_OPCODE_LDR_PC_OFFSET_I8 = 28u,
  THUMB_OPCODE_LDR_SP_OFFSET_I8 = 29u,
  THUMB_OPCODE_LDRB = 30u,
  THUMB_OPCODE_LDRB_I5 = 31u,
  THUMB_OPCODE_LDRH = 32u,
  THUMB_OPCODE_LDRH_I5 = 33u,
  THUMB_OPCODE_LDRSB = 34u,
  THUMB_OPCODE_LDRSH = 35u,
  THUMB_OPCODE_LSLS = 36u,
  THUMB_OPCODE_LSLS_I5 = 37u,
  THUMB_OPCODE_LSRS = 38u,
  THUMB_OPCODE_LSRS_I5 = 39u,
  THUMB_OPCODE_MOV_ANY = 40u,
  THUMB_OPCODE_MOVS_I8 = 41u,
  THUMB_OPCODE_MULS = 42u,
  THUMB_OPCODE_MVNS = 43u,
  THUMB_OPCODE_NEGS = 44u,
  THUMB_OPCODE_ORRS = 45u,
  THUMB_OPCODE_POP = 46u,
  THUMB_OPCODE_PUSH = 47u,
  THUMB_OPCODE_RORS = 48u,
  THUMB_OPCODE_SBCS = 49u,
  THUMB_OPCODE_STMIA = 50u,
  THUMB_OPCODE_STR = 51u,
  THUMB_OPCODE_STR_I5 = 52u,
  THUMB_OPCODE_STR_SP_OFFSET_I8 = 53u,
  THUMB_OPCODE_STRB = 54u,
  THUMB_OPCODE_STRB_I5 = 55u,
  THUMB_OPCODE_STRH = 56u,
  THUMB_OPCODE_STRH_I5 = 57u,
  THUMB_OPCODE_SUB_SP_I7 = 58u,
  THUMB_OPCODE_SUBS = 59u,
  THUMB_OPCODE_SUBS_I3 = 60u,
  THUMB_OPCODE_SUBS_I8 = 61u,
  THUMB_OPCODE_SWI = 62u,
  THUMB_OPCODE_TST = 63u,
  THUMB_OPCODE_UNDEF = 64u,
} ThumbOpcode;

static inline ThumbOpcode ThumbDecodeOpcode(uint16_t instruction) {
  static const uint8_t opcode_table[1024] = {
      37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u,
      37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u, 37u,
      37u, 37u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u,
      39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u, 39u,
      39u, 39u, 39u, 39u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u,
      10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u, 10u,
      10u, 10u, 10u, 10u, 10u, 10u, 5u,  5u,  5u,  5u,  5u,  5u,  5u,  5u,  59u,
      59u, 59u, 59u, 59u, 59u, 59u, 59u, 6u,  6u,  6u,  6u,  6u,  6u,  6u,  6u,
      60u, 60u, 60u, 60u, 60u, 60u, 60u, 60u, 41u, 41u, 41u, 41u, 41u, 41u, 41u,
      41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u,
      41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 41u, 22u, 22u, 22u, 22u, 22u,
      22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u,
      22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 22u, 7u,  7u,  7u,
      7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,
      7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  7u,  61u,
      61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u, 61u,
      61u, 8u,  24u, 36u, 38u, 9u,  0u,  49u, 48u, 63u, 44u, 21u, 20u, 45u, 42u,
      15u, 43u, 1u,  1u,  1u,  1u,  23u, 23u, 23u, 23u, 40u, 40u, 40u, 40u, 19u,
      19u, 64u, 64u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u,
      28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u, 28u,
      28u, 28u, 28u, 28u, 28u, 51u, 51u, 51u, 51u, 51u, 51u, 51u, 51u, 56u, 56u,
      56u, 56u, 56u, 56u, 56u, 56u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 54u, 34u,
      34u, 34u, 34u, 34u, 34u, 34u, 34u, 26u, 26u, 26u, 26u, 26u, 26u, 26u, 26u,
      32u, 32u, 32u, 32u, 32u, 32u, 32u, 32u, 30u, 30u, 30u, 30u, 30u, 30u, 30u,
      30u, 35u, 35u, 35u, 35u, 35u, 35u, 35u, 35u, 52u, 52u, 52u, 52u, 52u, 52u,
      52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u,
      52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 52u, 27u, 27u, 27u, 27u,
      27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u,
      27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 27u, 55u, 55u,
      55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u,
      55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u, 55u,
      31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u,
      31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u, 31u,
      31u, 31u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u,
      57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u, 57u,
      57u, 57u, 57u, 57u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u,
      33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u, 33u,
      33u, 33u, 33u, 33u, 33u, 33u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u,
      53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u,
      53u, 53u, 53u, 53u, 53u, 53u, 53u, 53u, 29u, 29u, 29u, 29u, 29u, 29u, 29u,
      29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u,
      29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 29u, 2u,  2u,  2u,  2u,  2u,
      2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,
      2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  2u,  3u,  3u,  3u,
      3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,
      3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  3u,  4u,
      4u,  58u, 58u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u,
      47u, 47u, 47u, 47u, 47u, 47u, 47u, 47u, 64u, 64u, 64u, 64u, 64u, 64u, 64u,
      64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u,
      64u, 64u, 46u, 46u, 46u, 46u, 46u, 46u, 46u, 46u, 64u, 64u, 64u, 64u, 64u,
      64u, 64u, 64u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u,
      50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u, 50u,
      50u, 50u, 50u, 50u, 50u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u,
      25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u, 25u,
      25u, 25u, 25u, 25u, 25u, 25u, 25u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u,
      12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u,
      14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u,
      14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u, 12u, 14u, 14u, 12u,
      12u, 14u, 14u, 64u, 64u, 64u, 64u, 62u, 62u, 62u, 62u, 11u, 11u, 11u, 11u,
      11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 11u, 13u, 13u, 13u,
      13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 13u, 17u, 17u,
      17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 17u, 18u,
      18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u, 18u,
      16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u,
      16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u, 16u,
      16u, 16u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u,
      64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u, 64u,
      64u, 64u, 64u, 64u,
  };

  uint_fast16_t opcode_index = instruction >> 6u;
  assert(opcode_index <= 1024);

  return (ThumbOpcode)opcode_table[opcode_index];
}

#endif  // _WEBGBA_EMULATOR_CPU_ARM7TDMI_DECODERS_THUMB_OPCODE_